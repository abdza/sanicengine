{% macro menunode(node) %}
<li>
	{% if node.children %}
	<a href='#toggle{{node.id}}' data-toggle='collapse' class='collapse-toggle' aria-expanded='false'>
		{% if 'icon' in node.data %}
		<span class="fa {{ node.data['icon'] }}"></span>
		{% endif %}
		<span class="mtext">{{ node.title }}</span>
	</a>
	<ul id='toggle{{node.id}}' class='collapse list-unstyled'>
		{% for cnode in node.children %}
		{{ menunode(cnode) }}
		{% endfor %}
	</ul>
	{% else %}
	<a href='{% if node.node_type=='page' %}{{ app.url_for('pages.view',module=node.module,slug=node.slug) }}{% elif node.node_type=='file' %}{{ app.url_for('fileLinks.download',module=node.module,slug=node.slug) }}{% elif node.node_type=='tracker' %}{{ app.url_for('trackers.viewlist',module=node.module,slug=node.slug) }}{% endif %}' class='no-arrow'>
		{% if 'icon' in node.data %}
		<span class="fa {{ node.data['icon'] }}"></span>
		{% endif %}
		<span class="mtext">{{ node.title }}</span>
	</a>
	{% endif %}
</li>
{% endmacro %}

{% macro sidemenu(module=None,slug=None) %}
<ul class='list-unstyled'>
{% for node in app.dbsession.query(app.trees.Tree).filter_by(module=module if module else 'portal',slug=slug if slug else 'site').first().rootnode.children %}
	{{ menunode(node) }}
{% endfor %}
</ul>
{% endmacro %}

{% macro adminmenu() %}
	<ul class='list-unstyled'>
	{% if curuser.superuser %}
	<li>
		<a href='{{ app.url_for('users.index') }}' class="no-arrow">
			<span class="fa fa-users"></span>
			<span class="mtext">Users</span>
		</a>
	</li>
	{% endif %}
	<li>
		<a href='{{ app.url_for('users.module_roles') }}' class="no-arrow">
			<span class="fa fa-address-card"></span>
			<span class="mtext">Roles</span>
		</a>
	</li>
	<li>
		<a href='{{ app.url_for('modules.index') }}' class="no-arrow">
			<span class="fa fa-book"></span>
			<span class="mtext">Modules</span>
		</a>
	</li>
	<li>
		<a href='{{ app.url_for('pages.index') }}' class="no-arrow">
			<span class="fa fa-file"></span>
			<span class="mtext">Pages</span>
		</a>
	</li>
	<li>
		<a href='{{ app.url_for('trees.index') }}' class="no-arrow">
			<span class="fa fa-sitemap"></span>
			<span class="mtext">Trees</span>
		</a>
	</li>
	<li>
		<a href='{{ app.url_for('fileLinks.index') }}' class="no-arrow">
			<span class="fa fa-upload"></span>
			<span class="mtext">Files</span>
		</a>
	</li>
	<li>
		<a href='{{ app.url_for('trackers.index') }}' class="no-arrow">
			<span class="fa fa-cogs"></span>
			<span class="mtext">Trackers</span>
		</a>
	</li>
	</ul>
{% endmacro %}
